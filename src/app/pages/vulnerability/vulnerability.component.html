<div
  class="nvip-content-container vuln-container col-12"
  ng-controller="VulnerabilityController as vulnCtrl"
  ng-init="getVulnInfo()"
>

  <div class="vuln-content">
    <div class="cve-search-panel">
      <p class="vuln-cve-number">{{ vuln.cveId }}</p>
    </div>

    <div class="vuln-tabbed-panel">
      <div class="vuln-tab-bar col-12">
        <button class="vuln-tab-button" (click)="openTab('vuln-description')">
          Description
        </button>
        <button class="vuln-tab-button" (click)="openTab('vuln-severity-tab')">
          CVSS Score
        </button>
        <button class="vuln-tab-button" (click)="openTab('vuln-products')">
          Affected Products
        </button>
        <button
          class="vuln-tab-button"
          (click)="openTab('vuln-characteristics')"
        >
          VDO Labels
        </button>
        <button class="vuln-tab-button" (click)="openTab('vuln-references')">
          Vulnerability Source
        </button>
      </div>
      <div class="vuln-panel">
        <div class="vuln-tab vuln-description">
          <p>{{ vuln.description }}</p>
          <c-accordion [hidden]="!vuln.altDescription">
            <c-accordion-item #item0="cAccordionItem" [visible]="false">
              <ng-template cTemplateId="accordionHeaderTemplate">
                <button (click)="item0.toggleItem()" [collapsed]="!item0.visible" cAccordionButton class="vuln-desc-drop">
                  See NVIP System Description
                </button>
              </ng-template>
              <ng-template cTemplateId="accordionBodyTemplate">
                <div class="accordion-body">
                  <strong>{{ vuln.altDescription && vuln.altDescription.description }}</strong>
                </div>
              </ng-template>
            </c-accordion-item>
          </c-accordion>
          <br />
          <table class="col-12">
            <tr>
              <td>
                <b>Published Date:</b> <br />
                {{ vuln.publishedDate }}
              </td>
              <td>
                <b>Last Modified Date:</b> <br />
                {{ vuln.lastModifiedDate }}
              </td>
              <td>
                <b>Created Date:</b> <br/>
                {{vuln.createdDate}}
              </td>
 <!--              <td>
                <b>Exploit Published Date:</b><br />
                {{ vuln.exploitPublishDate == "NA" ? "N/A" : vuln.exploitPublishDate }}
              </td> -->
            </tr>
            <tr>
              <td>
                <b>Patch:</b><br />
                <a href="{{ vuln.patch }}" target="_blank" *ngIf="vuln.patch && vuln.patch !== 'N/A'">Source</a>
                <span *ngIf="!vuln.patch || vuln.patch == 'N/A'">N/A</span>
              </td>
              <td>
                <b>Type: </b><br />
                {{ formatType(vuln.type) }}
              </td>
              <td>
                <b>Related Product: </b><br />
                {{ vuln.domain }}
              </td>
<!--               <td>
                <b>Status:</b><br />
                {{ vuln.status }}
              </td> -->
<!--               <td>
                <b>Exploit:</b><br />
                <a href="{{ vuln.exploitUrl }}" target="_blank" *ngIf="vuln.exploitUrl && vuln.exploitUrl !== 'N/A'">Source</a>
                <span *ngIf="!vuln.exploitUrl || vuln.exploitUrl !== 'NA'">N/A</span>
              </td> -->
            </tr>
            <!-- <tr>
              <td>
                <b>Fixed Date:</b><br />
                {{ vuln.fixedDate }}
              </td>
              
            </tr> -->
          </table>
          <br />
          <div
            id="divBtnOpenForReview"
            style="justify-content: center; align-items: center; display: none"
          >
            <!-- <a ng-href="#review/?cveid={{vuln.cveId}}" style="color: black; font-weight: bold;">Open For Review</a> -->
          </div>
        </div>
        <div class="vuln-tab vuln-severity-tab">
          <div  *ngFor="let cvssScore of vuln.cvssScoreList;">
            <c-row fluid>
              <c-col fluid>
                <strong>Qualitative Rating: </strong>
                <c-badge color="{{mapCVSSRating().color}}">{{mapCVSSRating().rating}}</c-badge>
              </c-col>
            </c-row>
            <c-row fluid style="height: 100%; max-height: 300px; min-height: 200px;">
              <cvss-gauge [cvssScore]="vuln.cvssScore" cvssId="cvss1"></cvss-gauge>
            </c-row>
          </div>
        </div>
        <div class="vuln-tab vuln-products">
          <p>Affected Common Platform Enumeration (CPE) Item(s)</p>

          <div
            class="vuln-reference-link"
            *ngFor="let cpe of vuln.cpes"
          >
            <a href="https://nvd.nist.gov/products/cpe/search/results?namingFormat=2.3&keyword={{cpe}}" target="_blank">{{cpe}}</a>
          </div>
        </div>
        <div class="vuln-tab vuln-characteristics">
          <c-container fluid>
            <c-row>
              <c-col md="8">
                <c-row>
                  <c-col>
                    <div>
                      Predicted Vulnerability Description Ontology (VDO) Labels and
                      Confidences
                    </div>
                    <c-badge class="nvip-gen-badge">NVIP</c-badge>
                    <c-badge>Admin Added</c-badge>
                  </c-col>
                </c-row>
                <c-row>
                  <div class="vuln-characteristics-graph-container">
                    <div class="vuln-characteristics-graph" *ngFor="let vdo of sortVdoList();">
                      <div [hidden]="!vdo.isActive" class="{{(vdo.userId === null) ? 'vuln-characteristics-bar' : 'vuln-characteristics-bar vulnbar-admin'}}">
                        <p>{{formatVdo(vdo.vdoLabel, true)}} : {{formatVdo(vdo.vdoLabel, false)}}</p>
                        <p>{{(vdo.vdoConfidence > 0) ? (vdo.vdoConfidence * 100).toFixed(2) + '%' : ''}}</p>
                      </div>
                    </div>
                  </div>
                </c-row>
              </c-col>
              <c-col md="4">
                <c-row>
                  <c-col class="d-flex justify-content-center">
                    <strong>Qualitative Rating: </strong>
                    <c-badge color="{{mapCVSSRating().color}}">{{mapCVSSRating().rating}}</c-badge>
                  </c-col>
                </c-row>
                <c-row fluid style="height: 100%; max-height: 300px; min-height: 200px;">
                  <div class="gauge-container">
                    <cvss-gauge [cvssScore]="vuln.cvssScore" cvssId="cvss2"></cvss-gauge>
                  </div>
                </c-row>
                <c-row>
                  <c-col class="d-flex justify-content-center">
                    <strong>CVSS v3.0 Base Score</strong>
                  </c-col>
                </c-row>
              </c-col>
            </c-row>
          </c-container>
        </div>
        <div class="vuln-tab vuln-references">
          <p>The source(s) where the vulnerability was found</p>
          <div
            class="vuln-rawdescription"
            *ngFor="let source of vuln.sources"
          >
            <c-row xs="auto">
              <c-col>
                <c-badge color="{{rawDescBadgeMap[source.isGarbage].color}}">{{rawDescBadgeMap[source.isGarbage].title}}</c-badge>
              </c-col>
              <c-col>
                <h2 class="vuln-rawdesc-title">{{extractDomainFromURL(source.sourceUrl)}}</h2>
              </c-col>
            </c-row>
            <p>{{sourceTypeMap.get(source.sourceType)}}</p>
            <a href="{{source.sourceUrl}}" target="_blank">View Source</a>
            <br />
            <br />
            <b>Raw Description:</b>
            <p>{{source.rawDescription}}</p>
            <c-row class="vuln-rawdesc-dates">
              <c-col>
                <b>Published Date:</b>
                <p>{{source.publishedDate}}</p>
              </c-col>
              <c-col>
                <b>Last Modified Date:</b>
                <p>{{source.lastModifiedDate}}</p>
              </c-col>
            </c-row>
          </div>
        </div>
        <div
          id="listProgressCircle"
          style="
            width: 100%;
            height: 100%;
            position: absolute;
            top: 30%;
            left: 40%;
          "
          [hidden]="!loading"
        >
          <fa-icon
            [icon]="faSpinner"
            animation="spin"
            size="3x"
            [fixedWidth]="true"
            [ngStyle]="{ color: 'black' }"
          ></fa-icon>
          <span>Loading...</span>
        </div>
      </div>
    </div>
  </div>
</div>
